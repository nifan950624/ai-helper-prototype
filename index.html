<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Helperæ’ä»¶ - äº¤äº’åŸå‹</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    :root {
      --vscode-bg: #1e1e1e;
      --vscode-sidebar-bg: #252526;
      --vscode-panel-bg: #2d2d2d;
      --vscode-input-bg: #3c3c3c;
      --vscode-border: #454545;
      --vscode-text: #cccccc;
      --vscode-text-secondary: #858585;
      --vscode-accent: #007acc;
      --vscode-accent-hover: #1e90ff;
      --vscode-success: #4ec9b0;
      --vscode-warning: #dcdcaa;
      --vscode-error: #f14c4c;
      --vscode-info: #3794ff;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background-color: #0d1117;
      color: var(--vscode-text);
      min-height: 100vh;
    }
    
    /* é¡¶éƒ¨å¯¼èˆª */
    .top-nav {
      background: var(--vscode-sidebar-bg);
      border-bottom: 1px solid var(--vscode-border);
      padding: 12px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .top-nav h1 {
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      color: #fff;
    }
    .nav-tabs {
      display: flex;
      gap: 4px;
    }
    .nav-tab {
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 13px;
      cursor: pointer;
      background: transparent;
      border: none;
      color: var(--vscode-text-secondary);
      transition: all .2s;
    }
    .nav-tab:hover {
      background: var(--vscode-input-bg);
      color: var(--vscode-text);
    }
    .nav-tab.active {
      background: var(--vscode-accent);
      color: #fff;
    }
    
    /* è§†å›¾åˆ‡æ¢ */
    .view-container { display: none; }
    .view-container.active { display: block; }
    
    /* äº¤äº’æ¼”ç¤ºè§†å›¾ */
    .demo-view {
      display: flex;
      height: calc(100vh - 53px);
    }
    .demo-sidebar {
      width: 300px;
      background: var(--vscode-sidebar-bg);
      border-right: 1px solid var(--vscode-border);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }
    .demo-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .demo-panel {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
      background: var(--vscode-bg);
    }
    
    /* ä¾§è¾¹æ æ ·å¼ */
    .sidebar {
      width: 100%;
      background: var(--vscode-sidebar-bg);
    }
    
    .sidebar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      border-bottom: 1px solid var(--vscode-border);
      background: var(--vscode-panel-bg);
    }
    
    .sidebar-header h3 {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      font-weight: 600;
    }
    
    .sidebar-section {
      border-bottom: 1px solid var(--vscode-border);
    }
    
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 16px;
      font-size: 12px;
      color: var(--vscode-text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .section-content {
      padding: 0 16px 16px;
    }
    
    /* éœ€æ±‚å¡ç‰‡ */
    .requirement-card {
      background: var(--vscode-panel-bg);
      border-radius: 8px;
      padding: 14px;
      border-left: 3px solid var(--vscode-accent);
    }
    
    .requirement-id {
      color: var(--vscode-accent);
      font-size: 12px;
      margin-bottom: 6px;
    }
    
    .requirement-title {
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 10px;
      line-height: 1.4;
    }
    
    .requirement-meta {
      display: flex;
      gap: 12px;
      font-size: 11px;
      color: var(--vscode-text-secondary);
      margin-bottom: 14px;
    }
    
    .requirement-meta span {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .btn-group {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      border: none;
      transition: all 0.2s;
    }
    
    .btn-primary {
      background: var(--vscode-accent);
      color: #fff;
    }
    
    .btn-primary:hover {
      background: var(--vscode-accent-hover);
    }
    
    .btn-secondary {
      background: var(--vscode-input-bg);
      color: var(--vscode-text);
    }
    
    .btn-secondary:hover {
      background: #4c4c4c;
    }
    
    /* ä»»åŠ¡åˆ—è¡¨ */
    .task-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .task-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      background: var(--vscode-panel-bg);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .task-item:hover {
      background: var(--vscode-input-bg);
    }
    
    .task-item.active, .task-item.selected {
      border: 2px solid var(--vscode-accent);
      background: rgba(0, 122, 204, 0.15);
    }
    
    .task-icon {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      flex-shrink: 0;
    }
    
    .task-icon.pending {
      border: 2px solid var(--vscode-text-secondary);
      color: transparent;
    }
    
    .task-icon.in-progress {
      background: var(--vscode-accent);
      color: #fff;
    }
    
    .task-icon.completed {
      background: var(--vscode-success);
      color: #fff;
    }
    
    .task-content {
      flex: 1;
      min-width: 0;
    }
    
    .task-title {
      font-size: 13px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .task-status {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 10px;
      flex-shrink: 0;
    }
    
    .task-status.pending {
      background: var(--vscode-input-bg);
      color: var(--vscode-text-secondary);
    }
    
    .task-status.in-progress {
      background: rgba(0, 122, 204, 0.2);
      color: var(--vscode-info);
    }
    
    .task-status.completed {
      background: rgba(78, 201, 176, 0.2);
      color: var(--vscode-success);
    }
    
    /* å¿«æ·æ“ä½œ */
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }
    
    .quick-action-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      padding: 14px 8px;
      background: var(--vscode-panel-bg);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid transparent;
    }
    
    .quick-action-btn:hover {
      background: var(--vscode-input-bg);
      border-color: var(--vscode-accent);
    }
    
    .quick-action-btn .icon {
      font-size: 20px;
    }
    
    .quick-action-btn .label {
      font-size: 11px;
      color: var(--vscode-text-secondary);
    }
    
    /* Modal å¼¹çª— */
    .modal {
      background: var(--vscode-sidebar-bg);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      border-bottom: 1px solid var(--vscode-border);
    }
    
    .modal-header h3 {
      font-size: 15px;
      font-weight: 600;
    }
    
    .modal-close {
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border-radius: 4px;
      font-size: 18px;
      color: var(--vscode-text-secondary);
    }
    
    .modal-close:hover {
      background: var(--vscode-input-bg);
      color: var(--vscode-text);
    }
    
    .modal-body {
      padding: 20px;
    }
    
    .form-group {
      margin-bottom: 18px;
    }
    
    .form-label {
      display: block;
      font-size: 12px;
      color: var(--vscode-text-secondary);
      margin-bottom: 8px;
    }
    
    .form-input {
      width: 100%;
      padding: 10px 12px;
      background: var(--vscode-input-bg);
      border: 1px solid var(--vscode-border);
      border-radius: 4px;
      color: var(--vscode-text);
      font-size: 13px;
    }
    
    .form-input:focus {
      outline: none;
      border-color: var(--vscode-accent);
    }
    
    .form-textarea {
      min-height: 80px;
      resize: vertical;
    }
    
    .divider {
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 20px 0;
      color: var(--vscode-text-secondary);
      font-size: 12px;
    }
    
    .divider::before,
    .divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--vscode-border);
    }
    
    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      padding: 16px 20px;
      border-top: 1px solid var(--vscode-border);
    }
    
    /* ç»“æ„åŒ–éœ€æ±‚å±•ç¤º */
    .structured-content {
      padding: 20px;
    }
    
    .structured-section {
      margin-bottom: 20px;
    }
    
    .structured-section-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      font-weight: 600;
      color: var(--vscode-text);
      margin-bottom: 10px;
    }
    
    .structured-section-title .emoji {
      font-size: 16px;
    }
    
    .structured-box {
      background: var(--vscode-panel-bg);
      border-radius: 6px;
      padding: 12px;
      font-size: 13px;
      line-height: 1.6;
    }
    
    .structured-list {
      list-style: none;
    }
    
    .structured-list li {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      font-size: 13px;
      line-height: 1.5;
      padding: 4px 0;
    }
    
    .structured-list li::before {
      content: 'â€¢';
      color: var(--vscode-accent);
    }
    
    .feature-item {
      background: var(--vscode-panel-bg);
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 10px;
    }
    
    .feature-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }
    
    .feature-number {
      background: var(--vscode-accent);
      color: #fff;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 600;
    }
    
    .feature-name {
      font-weight: 500;
      font-size: 13px;
    }
    
    .feature-sub {
      padding-left: 28px;
      font-size: 12px;
      color: var(--vscode-text-secondary);
    }
    
    .checklist {
      list-style: none;
    }
    
    .checklist li {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 6px 0;
      font-size: 13px;
    }
    
    .checkbox {
      width: 16px;
      height: 16px;
      border: 2px solid var(--vscode-text-secondary);
      border-radius: 3px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .checkbox.checked {
      background: var(--vscode-success);
      border-color: var(--vscode-success);
      color: #fff;
      font-size: 10px;
    }
    
    /* ä»£ç å»ºè®®é¢æ¿ */
    .code-panel {
      background: var(--vscode-sidebar-bg);
    }
    
    .code-panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 20px;
      border-bottom: 1px solid var(--vscode-border);
    }
    
    .code-panel-header h3 {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }
    
    .code-suggestion {
      border-bottom: 1px solid var(--vscode-border);
      padding: 16px 20px;
    }
    
    .code-file-path {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: var(--vscode-text-secondary);
      margin-bottom: 12px;
    }
    
    .code-file-path .icon {
      color: var(--vscode-warning);
    }
    
    .code-block {
      background: #1a1a1a;
      border-radius: 6px;
      padding: 14px;
      font-family: 'Fira Code', 'Consolas', monospace;
      font-size: 12px;
      line-height: 1.6;
      overflow-x: auto;
      margin-bottom: 12px;
    }
    
    .code-line {
      white-space: pre;
    }
    
    .code-line.add {
      color: var(--vscode-success);
    }
    
    .code-line.add::before {
      content: '+ ';
    }
    
    .code-line.remove {
      color: var(--vscode-error);
    }
    
    .code-line.remove::before {
      content: '- ';
    }
    
    .code-line.normal {
      color: var(--vscode-text-secondary);
    }
    
    .code-actions {
      display: flex;
      gap: 10px;
    }
    
    .ai-note {
      background: rgba(0, 122, 204, 0.1);
      border-radius: 6px;
      padding: 12px;
      font-size: 12px;
      line-height: 1.5;
      border-left: 3px solid var(--vscode-accent);
      margin-top: 16px;
    }
    
    .ai-note .title {
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 500;
      margin-bottom: 6px;
      color: var(--vscode-accent);
    }
    
    /* æŠ¥é”™åˆ†æé¢æ¿ */
    .error-panel {
      padding: 20px;
    }
    
    .error-section {
      margin-bottom: 20px;
    }
    
    .error-section-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: var(--vscode-text-secondary);
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .error-box {
      background: rgba(241, 76, 76, 0.1);
      border-radius: 6px;
      padding: 14px;
      border-left: 3px solid var(--vscode-error);
      font-family: 'Fira Code', 'Consolas', monospace;
      font-size: 12px;
      line-height: 1.6;
    }
    
    .error-stack {
      color: var(--vscode-text-secondary);
      margin-top: 8px;
    }
    
    .location-info {
      display: flex;
      flex-direction: column;
      gap: 6px;
      background: var(--vscode-panel-bg);
      padding: 12px;
      border-radius: 6px;
    }
    
    .location-row {
      display: flex;
      gap: 8px;
      font-size: 12px;
    }
    
    .location-row .label {
      color: var(--vscode-text-secondary);
      min-width: 40px;
    }
    
    .link-btn {
      color: var(--vscode-accent);
      cursor: pointer;
      font-size: 12px;
      text-decoration: underline;
      margin-top: 8px;
      display: inline-block;
    }
    
    .analysis-box {
      background: var(--vscode-panel-bg);
      border-radius: 6px;
      padding: 14px;
      font-size: 13px;
      line-height: 1.6;
    }
    
    .history-ref {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--vscode-border);
      font-size: 12px;
      color: var(--vscode-text-secondary);
    }
    
    .history-ref strong {
      color: var(--vscode-text);
    }
    
    .fix-suggestion {
      background: rgba(78, 201, 176, 0.1);
      border-radius: 6px;
      padding: 14px;
      border-left: 3px solid var(--vscode-success);
    }
    
    /* ä»»åŠ¡è¯¦æƒ…é¢æ¿ */
    .task-detail {
      padding: 20px;
    }
    
    .task-detail-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--vscode-border);
    }
    
    .task-detail-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 6px;
    }
    
    .task-detail-section {
      margin-bottom: 18px;
    }
    
    .task-detail-label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: var(--vscode-text-secondary);
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .file-list {
      list-style: none;
    }
    
    .file-list li,
    .file-list .file-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      font-size: 12px;
      font-family: 'Fira Code', 'Consolas', monospace;
      cursor: pointer;
      border-radius: 4px;
      transition: background 0.15s;
    }
    
    .file-list .file-item:hover {
      background: var(--vscode-hover);
    }
    
    .file-list .file-item .file-icon {
      font-size: 14px;
    }
    
    .file-list .file-item .file-name {
      flex: 1;
      color: var(--vscode-text);
    }
    
    .file-list .file-item .file-status {
      font-size: 10px;
      font-weight: 600;
      padding: 2px 6px;
      border-radius: 3px;
    }
    
    .file-list .file-item .file-status.modified {
      background: rgba(227, 179, 65, 0.2);
      color: #e3b341;
    }
    
    .file-list .file-item .file-status.new {
      background: rgba(63, 185, 80, 0.2);
      color: #3fb950;
    }
    
    .file-list .file-item .file-status.deleted {
      background: rgba(248, 81, 73, 0.2);
      color: #f85149;
    }
    
    .file-list li::before {
      content: 'ğŸ“„';
      font-size: 14px;
    }
    
    .file-list .file-item::before {
      content: none;
    }
    
    .dependency-tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      background: var(--vscode-panel-bg);
      border-radius: 4px;
      font-size: 12px;
    }
    
    .dependency-tag.completed::before {
      content: 'âœ“';
      color: var(--vscode-success);
    }
    
    .spec-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 12px;
      background: var(--vscode-panel-bg);
      border-radius: 4px;
      margin-bottom: 6px;
      font-size: 12px;
    }
    
    .spec-status {
      font-size: 11px;
      color: var(--vscode-success);
    }
    
    .task-detail-actions {
      display: flex;
      gap: 10px;
      padding-top: 16px;
      border-top: 1px solid var(--vscode-border);
    }
    
    /* äº¤äº’æ¼”ç¤ºä¸“ç”¨æ ·å¼ */
    .sidebar-header-demo {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
      border-bottom: 1px solid var(--vscode-border);
      background: var(--vscode-panel-bg);
    }
    .sidebar-header-demo h3 {
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .demo-section {
      border-bottom: 1px solid var(--vscode-border);
    }
    .demo-section-title {
      padding: 12px 16px;
      font-size: 11px;
      color: var(--vscode-text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .demo-section-content {
      padding: 0 12px 12px;
    }
    
    /* æµç¨‹æç¤ºæ¡ */
    .flow-hint {
      background: linear-gradient(135deg, var(--vscode-accent), #005a9e);
      color: #fff;
      padding: 12px 24px;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .flow-hint .step-indicator {
      background: rgba(255,255,255,0.2);
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
    }
    
    /* é¢æ¿å¡ç‰‡ */
    .panel-card {
      background: var(--vscode-sidebar-bg);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      max-width: 600px;
    }
    .panel-card-header {
      background: var(--vscode-panel-bg);
      padding: 14px 20px;
      border-bottom: 1px solid var(--vscode-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .panel-card-header h3 {
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .panel-card-body {
      padding: 20px;
    }
    
    /* Loading çŠ¶æ€ */
    .loading-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 60px 20px;
      text-align: center;
    }
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--vscode-border);
      border-top-color: var(--vscode-accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 16px;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .loading-text {
      color: var(--vscode-text-secondary);
      font-size: 13px;
    }
    
    /* ç©ºçŠ¶æ€ */
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 60px 20px;
      text-align: center;
      color: var(--vscode-text-secondary);
    }
    .empty-state .icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }
    .empty-state .title {
      font-size: 16px;
      color: var(--vscode-text);
      margin-bottom: 8px;
    }
    .empty-state .desc {
      font-size: 13px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <!-- äº¤äº’æ¼”ç¤ºè§†å›¾ -->
  <div id="demo-view" class="view-container active" style="display:block;">
    <div class="demo-view">
      <!-- å·¦ä¾§è¾¹æ  -->
      <div class="demo-sidebar">
        <div class="sidebar-header-demo">
          <h3>ğŸ¤– AI Helper</h3>
        </div>
        
        <!-- å½“å‰åˆ†æ”¯ -->
        <div class="demo-section" style="padding-bottom:0;">
          <div style="display:flex;align-items:center;gap:8px;padding:8px 12px;background:var(--vscode-panel-bg);border-radius:6px;font-size:12px;">
            <span>ğŸ”€</span>
            <span id="current-branch" style="font-family:monospace;color:var(--vscode-accent);">feat/payment-prepay</span>
            <span style="margin-left:auto;cursor:pointer;color:var(--vscode-text-secondary);" onclick="showBranchSwitch()">åˆ‡æ¢</span>
          </div>
        </div>
        
        <!-- å½“å‰éœ€æ±‚ -->
        <div class="demo-section">
          <div class="demo-section-title">
            <span>ğŸ“‹ å½“å‰éœ€æ±‚</span>
            <span style="cursor:pointer;font-size:12px;color:var(--vscode-text-secondary);" onclick="changeRequirement()">æ›´æ¢</span>
          </div>
          <div class="demo-section-content">
            <!-- å·²å…³è”éœ€æ±‚çŠ¶æ€ -->
            <div id="requirement-linked" class="requirement-card">
              <div class="requirement-id">#12345</div>
              <div class="requirement-title">é¢„çº¦å•æ”¯æŒé¢„ä»˜åŠŸèƒ½</div>
              <div class="requirement-meta">
                <span>ğŸ”µ å¼€å‘ä¸­</span>
                <span>ğŸ”´ P1</span>
              </div>
              <div class="btn-group">
                <button class="btn btn-primary" onclick="showPanel('structured')">æŸ¥çœ‹è¯¦æƒ…</button>
                <button class="btn btn-secondary" onclick="showPanel('task-gen')">ä»»åŠ¡æ‹†åˆ†</button>
              </div>
            </div>
            <!-- æœªå…³è”éœ€æ±‚çŠ¶æ€ -->
            <div id="requirement-unlinked" class="requirement-card" style="display:none;text-align:center;padding:20px 16px;">
              <div style="font-size:32px;margin-bottom:12px;opacity:0.5;">ğŸ”—</div>
              <div style="color:var(--vscode-text-secondary);margin-bottom:16px;font-size:13px;">å½“å‰åˆ†æ”¯æœªå…³è”éœ€æ±‚</div>
              <div class="btn-group" style="justify-content:center;">
                <button class="btn btn-primary" onclick="showTapdSelector()">ä» TAPD é€‰æ‹©</button>
                <button class="btn btn-secondary" onclick="showNewRequirement()">æ–°å»ºéœ€æ±‚</button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- ä»»åŠ¡åˆ—è¡¨ -->
        <div class="demo-section">
          <div class="demo-section-title">
            <span>ğŸ“ ä»»åŠ¡åˆ—è¡¨</span>
            <span style="cursor: pointer;" onclick="showPanel('task-gen')">â•</span>
          </div>
          <div class="demo-section-content">
            <div class="task-list" id="task-list">
              <div class="task-item" onclick="selectTask(1)">
                <div class="task-icon completed">âœ“</div>
                <div class="task-content">
                  <div class="task-title">T1: é¢„ä»˜å¼¹çª— UI æ”¹é€ </div>
                </div>
                <div class="task-status completed">å·²å®Œæˆ</div>
              </div>
              <div class="task-item" onclick="selectTask(2)">
                <div class="task-icon in-progress">â—</div>
                <div class="task-content">
                  <div class="task-title">T2: å¾®ä¿¡æ”¯ä»˜æ¥å£å¯¹æ¥</div>
                </div>
                <div class="task-status in-progress">å¼€å‘ä¸­</div>
              </div>
              <div class="task-item" onclick="selectTask(3)">
                <div class="task-icon pending"></div>
                <div class="task-content">
                  <div class="task-title">T3: åŸ‹ç‚¹ç»Ÿè®¡å®ç°</div>
                </div>
                <div class="task-status pending">å¾…å¼€å§‹</div>
              </div>
              <div class="task-item" onclick="selectTask(4)">
                <div class="task-icon pending"></div>
                <div class="task-content">
                  <div class="task-title">T4: å¼‚å¸¸è¾¹ç•Œå¤„ç†</div>
                </div>
                <div class="task-status pending">å¾…å¼€å§‹</div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- å·¥å…·ç®±ï¼ˆç‹¬ç«‹åŠŸèƒ½ï¼‰ -->
        <div class="demo-section">
          <div class="demo-section-title">
            <span>ğŸ§° å·¥å…·ç®±</span>
          </div>
          <div class="demo-section-content">
            <div class="quick-actions">
              <div class="quick-action-btn" onclick="showPanel('error')">
                <span class="icon">ğŸ›</span>
                <span class="label">åˆ†ææŠ¥é”™</span>
              </div>
              <div class="quick-action-btn" onclick="showPanel('knowledge')">
                <span class="icon">ğŸ“–</span>
                <span class="label">çŸ¥è¯†åº“</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- ä¸»é¢æ¿åŒºåŸŸ -->
      <div class="demo-main">
        <!-- é¢æ¿å†…å®¹ -->
        <div class="demo-panel" id="demo-panel">
          <!-- ä»»åŠ¡è¯¦æƒ…é¢æ¿ -->
          <div id="panel-task-detail" style="display:none;">
            <div class="panel-card">
              <div class="panel-card-header">
                <h3 id="task-detail-title">ğŸ“ ä»»åŠ¡è¯¦æƒ…</h3>
                <div class="task-status in-progress" id="task-detail-status">å¼€å‘ä¸­</div>
              </div>
              <div class="panel-card-body task-detail" style="padding:0;">
                <div class="task-detail-section">
                  <div class="task-detail-label">ğŸ“„ ä»»åŠ¡æè¿°</div>
                  <div class="structured-box" id="task-detail-desc">å¯¹æ¥å¾®ä¿¡æ”¯ä»˜ JSAPIï¼Œå®ç°é¢„çº¦å•é¢„ä»˜åŠŸèƒ½</div>
                </div>
                
                <div class="task-detail-section">
                  <div class="task-detail-label">ğŸ“‹ éœ€æ±‚èƒŒæ™¯</div>
                  <div class="structured-box" id="task-detail-background" style="font-size:12px;line-height:1.6;">
                    æ¥è‡ªéœ€æ±‚ <a href="#" style="color:var(--vscode-link);">#12345</a>ï¼šé¢„çº¦å•æ”¯æŒé¢„ä»˜åŠŸèƒ½
                  </div>
                </div>
                
                <div class="task-detail-section">
                  <div class="task-detail-label">âœ… éªŒæ”¶æ ‡å‡†</div>
                  <ul class="checklist" id="task-detail-checks">
                    <li><div class="checkbox"></div>è°ƒèµ·å¾®ä¿¡æ”¯ä»˜æˆåŠŸ</li>
                    <li><div class="checkbox"></div>æ”¯ä»˜ç»“æœå›è°ƒæ­£ç¡®å¤„ç†</li>
                    <li><div class="checkbox"></div>æ”¯ä»˜å¤±è´¥æœ‰é‡è¯•æœºåˆ¶</li>
                  </ul>
                </div>
                
                <div class="task-detail-section" style="background:var(--vscode-panel-bg);border-radius:6px;padding:12px;margin:12px 0;">
                  <div style="font-size:12px;color:var(--vscode-text-secondary);margin-bottom:8px;">
                    ğŸ’¡ ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ï¼Œå°†ä»»åŠ¡ä¿¡æ¯ä¼ é€’ç»™ AI æ’ä»¶è¿›è¡Œä»£ç ç”Ÿæˆæˆ–æ£€æŸ¥
                  </div>
                  <div class="task-detail-actions" style="margin-top:0;">
                    <button class="btn btn-primary" onclick="generateCode()">ğŸš€ è°ƒç”¨ AI ç”Ÿæˆ</button>
                    <button class="btn btn-secondary" onclick="codeCheck()">ğŸ” ä»£ç æ£€æŸ¥</button>
                  </div>
                </div>
                
                <div class="task-detail-actions" style="border-top:1px solid var(--vscode-border);padding-top:12px;">
                  <button class="btn btn-secondary" onclick="completeTask()">âœ“ æ ‡è®°å®Œæˆ</button>
                </div>
              </div>
            </div>
          </div>
          
          <!-- ä»£ç ç”Ÿæˆ Loading -->
          <div id="panel-code-loading" style="display:none;">
            <div class="panel-card">
              <div class="panel-card-header">
                <h3>âœ¨ AI ä»£ç ç”Ÿæˆ</h3>
              </div>
              <div class="loading-container">
                <div class="loading-spinner"></div>
                <div class="loading-text">æ­£åœ¨æ”¶é›†ä¸Šä¸‹æ–‡å¹¶ç”Ÿæˆä»£ç ...</div>
                <div class="loading-text" style="margin-top:8px;font-size:12px;color:var(--vscode-text-secondary);">
                  ğŸ“¦ ä»»åŠ¡ä¿¡æ¯ â†’ ğŸ“‹ éªŒæ”¶æ ‡å‡† â†’ ğŸ¤– è°ƒç”¨ AI æ’ä»¶
                </div>
              </div>
            </div>
          </div>
          
          <!-- ä»£ç ç”Ÿæˆç»“æœ -->
          <div id="panel-code-result" style="display:none;">
            <div class="panel-card" style="max-width:700px;">
              <div class="panel-card-header">
                <h3>ğŸ¤– AI ä»£ç å»ºè®®</h3>
                <button class="btn btn-primary">åº”ç”¨å…¨éƒ¨</button>
              </div>
              <div class="code-panel" style="background:transparent;">
                <div class="code-suggestion">
                  <div class="code-file-path">
                    <span class="icon">ğŸ“„</span>
                    services/payment/wechat.ts
                  </div>
                  <div class="code-block">
                    <div class="code-line add">import { requestPayment } from '@/utils/wx';</div>
                    <div class="code-line add"></div>
                    <div class="code-line add">export async function prepayOrder(params: {</div>
                    <div class="code-line add">  orderId: string;</div>
                    <div class="code-line add">  amount: number;</div>
                    <div class="code-line add">}) {</div>
                    <div class="code-line add">  try {</div>
                    <div class="code-line add">    const res = await api.createPrepayOrder(params);</div>
                    <div class="code-line add">    await requestPayment(res.payParams);</div>
                    <div class="code-line add">    return { success: true };</div>
                    <div class="code-line add">  } catch (error) {</div>
                    <div class="code-line add">    handlePaymentError(error);</div>
                    <div class="code-line add">    return { success: false, error };</div>
                    <div class="code-line add">  }</div>
                    <div class="code-line add">}</div>
                  </div>
                  <div class="code-actions">
                    <button class="btn btn-primary">åº”ç”¨æ­¤æ–‡ä»¶</button>
                    <button class="btn btn-secondary">å¿½ç•¥</button>
                  </div>
                </div>
                
                <div class="ai-note" style="margin:0 0 0 0;">
                  <div class="title">ğŸ’¡ AI è¯´æ˜</div>
                  åŸºäºå›¢é˜Ÿçš„æ”¯ä»˜æ¥å£è§„èŒƒï¼Œå·²æ·»åŠ  loading çŠ¶æ€ç®¡ç†å’Œç»Ÿä¸€çš„é”™è¯¯å¤„ç†ã€‚å»ºè®®åç»­å¢åŠ æ”¯ä»˜ç»“æœçš„åŸ‹ç‚¹ä¸ŠæŠ¥ã€‚
                </div>
              </div>
            </div>
          </div>
          
          <!-- ç»“æ„åŒ–éœ€æ±‚é¢æ¿ -->
          <div id="panel-structured" style="display:none;">
            <div class="panel-card" style="max-width:700px;">
              <div class="panel-card-header">
                <h3>ğŸ“Š ç»“æ„åŒ–éœ€æ±‚</h3>
                <span style="color:var(--vscode-text-secondary);font-size:12px;">#12345 é¢„çº¦å•æ”¯æŒé¢„ä»˜åŠŸèƒ½</span>
              </div>
              <div class="panel-card-body structured-content" style="padding:0;">
                <div class="structured-section">
                  <div class="structured-section-title">
                    <span class="emoji">ğŸ“Œ</span> ä¸šåŠ¡èƒŒæ™¯
                  </div>
                  <div class="structured-box">
                    å½“å‰é¢„çº¦å•ä¸æ”¯æŒé¢„ä»˜ï¼Œç”¨æˆ·éœ€è¦è¡Œç¨‹ç»“æŸåæ‰èƒ½ä»˜æ¬¾ï¼Œå­˜åœ¨é€ƒå•é£é™©ï¼Œéœ€è¦å¢åŠ é¢„ä»˜èƒ½åŠ›é™ä½é£é™©ã€‚
                  </div>
                </div>
                
                <div class="structured-section">
                  <div class="structured-section-title">
                    <span class="emoji">ğŸ¯</span> ä¸šåŠ¡ç›®æ ‡
                  </div>
                  <ul class="structured-list">
                    <li>é™ä½é¢„çº¦å•é€ƒå•ç‡ 30%</li>
                    <li>æå‡ç”¨æˆ·æ”¯ä»˜ä½“éªŒ</li>
                  </ul>
                </div>
                
                <div class="structured-section">
                  <div class="structured-section-title">
                    <span class="emoji">ğŸ“</span> åŠŸèƒ½ç‚¹åˆ—è¡¨
                  </div>
                  <div class="feature-item">
                    <div class="feature-header">
                      <span class="feature-number">1</span>
                      <span class="feature-name">é¢„ä»˜å…¥å£å±•ç¤º</span>
                    </div>
                    <div class="feature-sub">
                      â€¢ é¢„çº¦å•è¯¦æƒ…é¡µå¢åŠ ã€Œç«‹å³é¢„ä»˜ã€æŒ‰é’®<br>
                      â€¢ æŒ‰é’®åœ¨è®¢å•çŠ¶æ€ä¸ºã€Œå¾…å‡ºå‘ã€æ—¶å±•ç¤º
                    </div>
                  </div>
                  <div class="feature-item">
                    <div class="feature-header">
                      <span class="feature-number">2</span>
                      <span class="feature-name">é¢„ä»˜å¼¹çª—</span>
                    </div>
                    <div class="feature-sub">
                      â€¢ å±•ç¤ºé¢„ä¼°é‡‘é¢<br>
                      â€¢ æ”¯æŒå¾®ä¿¡æ”¯ä»˜ / ä½™é¢æ”¯ä»˜
                    </div>
                  </div>
                </div>
                
                <div class="structured-section">
                  <div class="structured-section-title">
                    <span class="emoji">âœ…</span> éªŒæ”¶æ ‡å‡†
                  </div>
                  <ul class="checklist">
                    <li><div class="checkbox"></div>é¢„ä»˜æµç¨‹ç«¯åˆ°ç«¯å¯ç”¨</li>
                    <li><div class="checkbox"></div>å¼‚å¸¸åœºæ™¯æœ‰å…œåº•</li>
                    <li><div class="checkbox checked">âœ“</div>åŸ‹ç‚¹æ•°æ®æ­£ç¡®ä¸ŠæŠ¥</li>
                  </ul>
                </div>
                
                <div class="btn-group" style="padding-top:16px;border-top:1px solid var(--vscode-border);">
                  <button class="btn btn-primary" onclick="showPanel('task-gen')">ğŸ“ ç”Ÿæˆä»»åŠ¡æ‹†è§£</button>
                  <button class="btn btn-secondary">âœï¸ ç¼–è¾‘éœ€æ±‚</button>
                </div>
              </div>
            </div>
          </div>
          
          <!-- åˆ†ææŠ¥é”™é¢æ¿ -->
          <div id="panel-error" style="display:none;">
            <div class="panel-card" style="max-width:700px;">
              <div class="panel-card-header">
                <h3>ğŸ› åˆ†ææŠ¥é”™</h3>
              </div>
              <div class="panel-card-body" style="padding:16px;">
                <div style="margin-bottom:12px;">
                  <div style="font-size:13px;margin-bottom:8px;color:var(--vscode-text-secondary);">ç²˜è´´æŠ¥é”™ä¿¡æ¯ï¼š</div>
                  <textarea id="error-input" placeholder="åœ¨æ­¤ç²˜è´´æ§åˆ¶å°æŠ¥é”™ã€ç¼–è¯‘é”™è¯¯æˆ–å¼‚å¸¸å †æ ˆä¿¡æ¯..." style="width:100%;height:140px;background:var(--vscode-input-bg);border:1px solid var(--vscode-border);padding:12px;border-radius:6px;color:var(--vscode-text);font-size:12px;font-family:monospace;resize:vertical;"></textarea>
                </div>
                <div class="btn-group" style="margin-bottom:16px;">
                  <button class="btn btn-primary" onclick="analyzeError()">ğŸ” åˆ†ææŠ¥é”™</button>
                  <button class="btn btn-secondary" onclick="document.getElementById('error-input').value=''">æ¸…ç©º</button>
                </div>
                
                <!-- åˆ†æç»“æœåŒºåŸŸ -->
                <div id="error-result" style="display:none;">
                  <div style="border-top:1px solid var(--vscode-border);padding-top:16px;">
                    <div style="font-size:13px;font-weight:500;margin-bottom:12px;color:var(--vscode-accent);">ğŸ’¡ AI åˆ†æç»“æœ</div>
                    <div id="error-analysis" style="background:var(--vscode-panel-bg);padding:14px;border-radius:6px;font-size:13px;line-height:1.6;border-left:3px solid var(--vscode-accent);"></div>
                    <div class="btn-group" style="margin-top:12px;">
                      <button class="btn btn-secondary" onclick="copyAnalysis()">ğŸ“‹ å¤åˆ¶åˆ†æ</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- çŸ¥è¯†åº“é¢æ¿ -->
          <div id="panel-knowledge" style="display:none;">
            <div class="panel-card" style="max-width:700px;">
              <div class="panel-card-header">
                <h3>ğŸ“– å›¢é˜ŸçŸ¥è¯†åº“</h3>
                <div style="display:flex;gap:8px;">
                  <input type="text" placeholder="æœç´¢..." style="background:var(--vscode-input-bg);border:none;padding:6px 12px;border-radius:4px;color:var(--vscode-text);font-size:12px;width:160px;">
                </div>
              </div>
              <div class="panel-card-body" style="padding:0;">
                <div class="knowledge-category" style="border-bottom:1px solid var(--vscode-border);">
                  <div style="padding:12px 16px;background:var(--vscode-panel-bg);font-size:12px;color:var(--vscode-text-secondary);text-transform:uppercase;">ğŸ“ ç¼–ç è§„èŒƒ</div>
                  <div class="knowledge-item" style="padding:12px 16px;cursor:pointer;display:flex;align-items:center;gap:10px;border-bottom:1px solid var(--vscode-border);">
                    <span>ğŸ“„</span>
                    <div>
                      <div style="font-size:13px;margin-bottom:2px;">TypeScript ç¼–ç è§„èŒƒ</div>
                      <div style="font-size:11px;color:var(--vscode-text-secondary);">å‘½åçº¦å®šã€ç±»å‹å®šä¹‰ã€æœ€ä½³å®è·µ</div>
                    </div>
                  </div>
                  <div class="knowledge-item" style="padding:12px 16px;cursor:pointer;display:flex;align-items:center;gap:10px;border-bottom:1px solid var(--vscode-border);">
                    <span>ğŸ“„</span>
                    <div>
                      <div style="font-size:13px;margin-bottom:2px;">å°ç¨‹åºå¼€å‘è§„èŒƒ</div>
                      <div style="font-size:11px;color:var(--vscode-text-secondary);">é¡µé¢ç»“æ„ã€ç»„ä»¶è®¾è®¡ã€æ€§èƒ½ä¼˜åŒ–</div>
                    </div>
                  </div>
                </div>
                <div class="knowledge-category">
                  <div style="padding:12px 16px;background:var(--vscode-panel-bg);font-size:12px;color:var(--vscode-text-secondary);text-transform:uppercase;">ğŸ§© ç»„ä»¶æ–‡æ¡£</div>
                  <div class="knowledge-item" style="padding:12px 16px;cursor:pointer;display:flex;align-items:center;gap:10px;border-bottom:1px solid var(--vscode-border);">
                    <span>ğŸ“¦</span>
                    <div>
                      <div style="font-size:13px;margin-bottom:2px;">æ”¯ä»˜ç»„ä»¶ä½¿ç”¨æŒ‡å—</div>
                      <div style="font-size:11px;color:var(--vscode-text-secondary);">å¾®ä¿¡æ”¯ä»˜ã€ä½™é¢æ”¯ä»˜ã€æ”¯ä»˜å›è°ƒ</div>
                    </div>
                  </div>
                  <div class="knowledge-item" style="padding:12px 16px;cursor:pointer;display:flex;align-items:center;gap:10px;">
                    <span>ğŸ“¦</span>
                    <div>
                      <div style="font-size:13px;margin-bottom:2px;">åŸ‹ç‚¹ SDK æ¥å…¥æ–‡æ¡£</div>
                      <div style="font-size:11px;color:var(--vscode-text-secondary);">äº‹ä»¶å®šä¹‰ã€ä¸ŠæŠ¥æ—¶æœºã€è°ƒè¯•æ–¹æ³•</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- ä»»åŠ¡æ‹†åˆ†ç»“æœé¢æ¿ -->
          <div id="panel-task-split" style="display:none;">
            <div class="panel-card">
              <div class="panel-card-header">
                <h3>ğŸ“ ä»»åŠ¡æ‹†åˆ†ç»“æœ</h3>
                <span style="font-size:12px;color:var(--vscode-text-secondary);">AI ç”Ÿæˆ</span>
              </div>
              <div class="panel-card-body" style="padding:0;">
                <div style="padding:16px;font-size:12px;color:var(--vscode-text-secondary);background:var(--vscode-panel-bg);border-bottom:1px solid var(--vscode-border);">
                  åŸºäºéœ€æ±‚ã€Œé¢„çº¦å•æ”¯æŒé¢„ä»˜åŠŸèƒ½ã€æ‹†åˆ†ä¸ºä»¥ä¸‹å¼€å‘ä»»åŠ¡ï¼š
                </div>
                <div class="task-list" style="padding:12px;" id="split-task-list">
                  <div class="task-item" style="border:1px solid var(--vscode-border);">
                    <div class="task-icon pending"></div>
                    <div class="task-content">
                      <div class="task-title">T1: é¢„ä»˜å¼¹çª— UI æ”¹é€ </div>
                      <div style="font-size:11px;color:var(--vscode-text-secondary);margin-top:4px;">ä¿®æ”¹å¼¹çª—å¸ƒå±€ï¼Œå¢åŠ é¢„ä»˜é€‰é¡¹</div>
                    </div>
                  </div>
                  <div class="task-item" style="border:1px solid var(--vscode-border);">
                    <div class="task-icon pending"></div>
                    <div class="task-content">
                      <div class="task-title">T2: å¾®ä¿¡æ”¯ä»˜æ¥å£å¯¹æ¥</div>
                      <div style="font-size:11px;color:var(--vscode-text-secondary);margin-top:4px;">è°ƒç”¨å¾®ä¿¡æ”¯ä»˜ JSAPI å®Œæˆæ”¯ä»˜</div>
                    </div>
                  </div>
                  <div class="task-item" style="border:1px solid var(--vscode-border);">
                    <div class="task-icon pending"></div>
                    <div class="task-content">
                      <div class="task-title">T3: åŸ‹ç‚¹ç»Ÿè®¡å®ç°</div>
                      <div style="font-size:11px;color:var(--vscode-text-secondary);margin-top:4px;">æ·»åŠ æ”¯ä»˜æµç¨‹åŸ‹ç‚¹</div>
                    </div>
                  </div>
                  <div class="task-item" style="border:1px solid var(--vscode-border);">
                    <div class="task-icon pending"></div>
                    <div class="task-content">
                      <div class="task-title">T4: å¼‚å¸¸è¾¹ç•Œå¤„ç†</div>
                      <div style="font-size:11px;color:var(--vscode-text-secondary);margin-top:4px;">æ”¯ä»˜å¤±è´¥ã€è¶…æ—¶ç­‰å¼‚å¸¸å¤„ç†</div>
                    </div>
                  </div>
                </div>
                <div style="padding:16px;border-top:1px solid var(--vscode-border);">
                  <div class="btn-group">
                    <button class="btn btn-primary" onclick="confirmTaskSplit()">âœ“ ç¡®è®¤å¹¶æ·»åŠ åˆ°ä»»åŠ¡åˆ—è¡¨</button>
                    <button class="btn btn-secondary" onclick="showPanel('structured')">è¿”å›éœ€æ±‚</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- è®¾ç½®é¢æ¿ -->
          <div id="panel-settings" style="display:none;">
            <div class="panel-card" style="max-width:500px;">
              <div class="panel-card-header">
                <h3>âš™ï¸ æ’ä»¶è®¾ç½®</h3>
              </div>
              <div class="panel-card-body" style="padding:0;">
                <div class="settings-section" style="padding:16px;border-bottom:1px solid var(--vscode-border);">
                  <div style="font-size:13px;font-weight:500;margin-bottom:12px;">ğŸ¤– AI æ¨¡å‹</div>
                  <select style="width:100%;background:var(--vscode-input-bg);border:1px solid var(--vscode-border);padding:8px 12px;border-radius:4px;color:var(--vscode-text);font-size:13px;">
                    <option>GPT-4 (æ¨è)</option>
                    <option>GPT-3.5-turbo</option>
                    <option>Claude 3</option>
                  </select>
                </div>
                <div class="settings-section" style="padding:16px;border-bottom:1px solid var(--vscode-border);">
                  <div style="font-size:13px;font-weight:500;margin-bottom:12px;">ğŸ“Š TAPD é…ç½®</div>
                  <div style="margin-bottom:10px;">
                    <label style="font-size:12px;color:var(--vscode-text-secondary);display:block;margin-bottom:4px;">é¡¹ç›® ID</label>
                    <input type="text" value="12345678" style="width:100%;background:var(--vscode-input-bg);border:1px solid var(--vscode-border);padding:8px 12px;border-radius:4px;color:var(--vscode-text);font-size:13px;">
                  </div>
                  <div>
                    <label style="font-size:12px;color:var(--vscode-text-secondary);display:block;margin-bottom:4px;">Access Token</label>
                    <input type="password" value="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" style="width:100%;background:var(--vscode-input-bg);border:1px solid var(--vscode-border);padding:8px 12px;border-radius:4px;color:var(--vscode-text);font-size:13px;">
                  </div>
                </div>
                <div class="settings-section" style="padding:16px;">
                  <div style="font-size:13px;font-weight:500;margin-bottom:12px;">ğŸ”” é€šçŸ¥è®¾ç½®</div>
                  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
                    <span style="font-size:13px;">ä»£ç ç”Ÿæˆå®Œæˆé€šçŸ¥</span>
                    <div style="width:40px;height:22px;background:var(--vscode-accent);border-radius:11px;position:relative;cursor:pointer;">
                      <div style="width:18px;height:18px;background:#fff;border-radius:50%;position:absolute;right:2px;top:2px;"></div>
                    </div>
                  </div>
                  <div style="display:flex;align-items:center;justify-content:space-between;">
                    <span style="font-size:13px;">æŠ¥é”™æ£€æµ‹é€šçŸ¥</span>
                    <div style="width:40px;height:22px;background:var(--vscode-accent);border-radius:11px;position:relative;cursor:pointer;">
                      <div style="width:18px;height:18px;background:#fff;border-radius:50%;position:absolute;right:2px;top:2px;"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // å½“å‰é€‰ä¸­çš„ä»»åŠ¡
    let selectedTaskId = null;
    
    // ä»»åŠ¡æ•°æ®
    const tasks = {
      1: {
        title: 'T1: é¢„ä»˜å¼¹çª— UI æ”¹é€ ',
        status: 'completed',
        statusText: 'å·²å®Œæˆ',
        desc: 'å®ç°é¢„ä»˜å¼¹çª—çš„ UI ç»„ä»¶ï¼ŒåŒ…æ‹¬é‡‘é¢å±•ç¤ºã€æ”¯ä»˜æ–¹å¼é€‰æ‹©ã€æŒ‰é’®äº¤äº’',
        checks: ['å¼¹çª—æ ·å¼ç¬¦åˆè®¾è®¡ç¨¿', 'æ”¯ä»˜æ–¹å¼åˆ‡æ¢æ­£å¸¸', 'é‡‘é¢å±•ç¤ºæ­£ç¡®']
      },
      2: {
        title: 'T2: å¾®ä¿¡æ”¯ä»˜æ¥å£å¯¹æ¥',
        status: 'in-progress',
        statusText: 'å¼€å‘ä¸­',
        desc: 'å¯¹æ¥å¾®ä¿¡æ”¯ä»˜ JSAPIï¼Œå®ç°é¢„çº¦å•é¢„ä»˜åŠŸèƒ½',
        checks: ['è°ƒèµ·å¾®ä¿¡æ”¯ä»˜æˆåŠŸ', 'æ”¯ä»˜ç»“æœå›è°ƒæ­£ç¡®å¤„ç†', 'æ”¯ä»˜å¤±è´¥æœ‰é‡è¯•æœºåˆ¶']
      },
      3: {
        title: 'T3: åŸ‹ç‚¹ç»Ÿè®¡å®ç°',
        status: 'pending',
        statusText: 'å¾…å¼€å§‹',
        desc: 'å®ç°é¢„ä»˜æµç¨‹çš„åŸ‹ç‚¹ä¸ŠæŠ¥ï¼ŒåŒ…æ‹¬æ›å…‰ã€ç‚¹å‡»ã€ç»“æœç­‰å…³é”®èŠ‚ç‚¹',
        checks: ['åŸ‹ç‚¹å‚æ•°æ­£ç¡®', 'ä¸ŠæŠ¥æ—¶æœºæ­£ç¡®', 'æ•°æ®å¯åœ¨å¹³å°æŸ¥çœ‹']
      },
      4: {
        title: 'T4: å¼‚å¸¸è¾¹ç•Œå¤„ç†',
        status: 'pending',
        statusText: 'å¾…å¼€å§‹',
        desc: 'å¤„ç†å„ç§å¼‚å¸¸åœºæ™¯ï¼šç½‘ç»œé”™è¯¯ã€æ”¯ä»˜è¶…æ—¶ã€é‡‘é¢å˜åŒ–ç­‰',
        checks: ['ç½‘ç»œé”™è¯¯æœ‰æç¤º', 'æ”¯ä»˜è¶…æ—¶å¯é‡è¯•', 'é‡‘é¢å˜åŒ–æœ‰å¼¹çª—ç¡®è®¤']
      }
    };
    
    // é€‰ä¸­ä»»åŠ¡
    function selectTask(id) {
      selectedTaskId = id;
      
      // æ›´æ–°ä»»åŠ¡åˆ—è¡¨é«˜äº®
      document.querySelectorAll('#task-list .task-item').forEach((item, index) => {
        item.classList.toggle('selected', index + 1 === id);
      });
      
      // æ˜¾ç¤ºä»»åŠ¡è¯¦æƒ…
      const task = tasks[id];
      document.getElementById('task-detail-title').textContent = 'ğŸ“ ' + task.title;
      document.getElementById('task-detail-status').textContent = task.statusText;
      document.getElementById('task-detail-status').className = 'task-status ' + task.status;
      document.getElementById('task-detail-desc').textContent = task.desc;
      document.getElementById('task-detail-checks').innerHTML = task.checks.map(c => '<li><div class="checkbox"></div>' + c + '</li>').join('');
      
      // æ›´æ–°æµç¨‹æç¤º
      updateFlowHint(1, 'å·²é€‰æ‹©ä»»åŠ¡ã€Œ' + task.title + 'ã€ï¼Œç‚¹å‡»ã€Œè°ƒç”¨ AI ç”Ÿæˆã€å¼€å§‹å¼€å‘');
      
      showPanel('task-detail');
    }
    
    // æ˜¾ç¤ºé¢æ¿
    function showPanel(panel) {
      document.getElementById('panel-task-detail').style.display = 'none';
      document.getElementById('panel-code-loading').style.display = 'none';
      document.getElementById('panel-code-result').style.display = 'none';
      document.getElementById('panel-structured').style.display = 'none';
      document.getElementById('panel-error').style.display = 'none';
      document.getElementById('panel-knowledge').style.display = 'none';
      document.getElementById('panel-settings').style.display = 'none';
      document.getElementById('panel-task-split').style.display = 'none';
      
      if (panel === 'task-detail') {
        document.getElementById('panel-task-detail').style.display = 'block';
      } else if (panel === 'code-loading') {
        document.getElementById('panel-code-loading').style.display = 'block';
      } else if (panel === 'code-result') {
        document.getElementById('panel-code-result').style.display = 'block';
      } else if (panel === 'structured') {
        document.getElementById('panel-structured').style.display = 'block';
        updateFlowHint(0, 'æŸ¥çœ‹ç»“æ„åŒ–éœ€æ±‚ï¼Œç‚¹å‡»ã€Œç”Ÿæˆä»»åŠ¡æ‹†è§£ã€å¯è‡ªåŠ¨ç”Ÿæˆå¼€å‘ä»»åŠ¡');
      } else if (panel === 'task-gen') {
        // æ¨¡æ‹Ÿä»»åŠ¡æ‹†åˆ†ç”Ÿæˆ
        document.getElementById('panel-code-loading').querySelector('.loading-text').textContent = 'æ­£åœ¨åˆ†æéœ€æ±‚å¹¶ç”Ÿæˆä»»åŠ¡æ‹†è§£...';
        document.getElementById('panel-code-loading').style.display = 'block';
        updateFlowHint(0, 'AI æ­£åœ¨åˆ†æéœ€æ±‚ï¼Œç”Ÿæˆä»»åŠ¡æ‹†è§£...');
        setTimeout(function() {
          document.getElementById('panel-code-loading').style.display = 'none';
          document.getElementById('panel-task-split').style.display = 'block';
          updateFlowHint(0, 'ä»»åŠ¡æ‹†åˆ†å®Œæˆï¼Œç¡®è®¤åå°†æ·»åŠ åˆ°ä»»åŠ¡åˆ—è¡¨');
        }, 1500);
      } else if (panel === 'task-split') {
        document.getElementById('panel-task-split').style.display = 'block';
        updateFlowHint(0, 'ä»»åŠ¡æ‹†åˆ†å®Œæˆï¼Œç¡®è®¤åå°†æ·»åŠ åˆ°ä»»åŠ¡åˆ—è¡¨');
      } else if (panel === 'error') {
        document.getElementById('panel-error').style.display = 'block';
        updateFlowHint(0, 'åˆ†æå½“å‰æ–‡ä»¶æˆ–æ§åˆ¶å°çš„æŠ¥é”™ï¼Œè·å–ä¿®å¤å»ºè®®');
      } else if (panel === 'knowledge') {
        document.getElementById('panel-knowledge').style.display = 'block';
        updateFlowHint(0, 'æŸ¥é˜…å›¢é˜ŸçŸ¥è¯†åº“ï¼ŒåŒ…æ‹¬ç¼–ç è§„èŒƒã€ç»„ä»¶æ–‡æ¡£ç­‰');
      } else if (panel === 'settings') {
        document.getElementById('panel-settings').style.display = 'block';
        updateFlowHint(0, 'é…ç½® AI Helper æ’ä»¶é€‰é¡¹');
      }
    }
    
    // åˆ†æ”¯-éœ€æ±‚æ˜ å°„ç¼“å­˜
    const branchRequirementMap = {
      'feat/payment-prepay': { id: '#12345', title: 'é¢„çº¦å•æ”¯æŒé¢„ä»˜åŠŸèƒ½', status: 'å¼€å‘ä¸­', priority: 'P1' },
      'feat/order-refund': { id: '#12346', title: 'è®¢å•é€€æ¬¾æµç¨‹ä¼˜åŒ–', status: 'å¾…å¼€å‘', priority: 'P2' },
      'fix/login-bug': null,  // æœªå…³è”éœ€æ±‚
      'main': null
    };
    
    // æ˜¾ç¤ºåˆ†æ”¯åˆ‡æ¢å¼¹çª—
    function showBranchSwitch() {
      const branches = Object.keys(branchRequirementMap);
      const currentBranch = document.getElementById('current-branch').textContent;
      
      let options = branches.map(b => {
        const req = branchRequirementMap[b];
        const linked = req ? `â†’ ${req.id} ${req.title}` : '(æœªå…³è”)';
        const selected = b === currentBranch ? ' âœ“' : '';
        return `${b} ${linked}${selected}`;
      }).join('\n');
      
      const selected = prompt(`é€‰æ‹©åˆ†æ”¯åˆ‡æ¢ï¼ˆæ¼”ç¤ºï¼‰ï¼š\n\n${options}\n\nè¾“å…¥åˆ†æ”¯åï¼š`, 'fix/login-bug');
      if (selected && branchRequirementMap.hasOwnProperty(selected)) {
        switchBranch(selected);
      }
    }
    
    // åˆ‡æ¢åˆ†æ”¯
    function switchBranch(branchName) {
      document.getElementById('current-branch').textContent = branchName;
      const requirement = branchRequirementMap[branchName];
      const taskSection = document.querySelector('.demo-sidebar .demo-section:nth-child(4)'); // ä»»åŠ¡åˆ—è¡¨åŒºåŸŸ
      
      if (requirement) {
        // æœ‰å…³è”éœ€æ±‚ï¼Œæ˜¾ç¤ºéœ€æ±‚å¡ç‰‡å’Œä»»åŠ¡åˆ—è¡¨
        document.getElementById('requirement-linked').style.display = 'block';
        document.getElementById('requirement-unlinked').style.display = 'none';
        document.getElementById('requirement-linked').querySelector('.requirement-id').textContent = requirement.id;
        document.getElementById('requirement-linked').querySelector('.requirement-title').textContent = requirement.title;
        if (taskSection) taskSection.style.display = 'block';
        updateFlowHint(0, `å·²åˆ‡æ¢åˆ°åˆ†æ”¯ ${branchName}ï¼Œè‡ªåŠ¨åŠ è½½å…³è”éœ€æ±‚ ${requirement.id}`);
      } else {
        // æ— å…³è”éœ€æ±‚ï¼Œæ˜¾ç¤ºæœªå…³è”çŠ¶æ€ï¼Œéšè—ä»»åŠ¡åˆ—è¡¨
        document.getElementById('requirement-linked').style.display = 'none';
        document.getElementById('requirement-unlinked').style.display = 'block';
        if (taskSection) taskSection.style.display = 'none';
        updateFlowHint(0, `åˆ†æ”¯ ${branchName} å°šæœªå…³è”éœ€æ±‚ï¼Œè¯·é€‰æ‹©æˆ–æ–°å»º`);
      }
    }
    
    // æ›´æ¢éœ€æ±‚
    function changeRequirement() {
      if (confirm('ç¡®å®šè¦æ›´æ¢å½“å‰éœ€æ±‚å—ï¼Ÿ\n\næ›´æ¢åä»»åŠ¡åˆ—è¡¨ä¼šæ¸…ç©ºã€‚')) {
        document.getElementById('requirement-linked').style.display = 'none';
        document.getElementById('requirement-unlinked').style.display = 'block';
        const taskSection = document.querySelector('.demo-sidebar .demo-section:nth-child(4)');
        if (taskSection) taskSection.style.display = 'none';
        updateFlowHint(0, 'è¯·ä» TAPD é€‰æ‹©éœ€æ±‚æˆ–æ–°å»ºéœ€æ±‚');
      }
    }
    
    // æ˜¾ç¤º TAPD é€‰æ‹©å™¨
    function showTapdSelector() {
      const tapdList = [
        '#12345 é¢„çº¦å•æ”¯æŒé¢„ä»˜åŠŸèƒ½',
        '#12346 è®¢å•é€€æ¬¾æµç¨‹ä¼˜åŒ–',
        '#12347 å¸æœºç«¯æ¶ˆæ¯æ¨é€',
        '#12348 ä¹˜å®¢è¯„ä»·ç³»ç»Ÿæ”¹ç‰ˆ'
      ];
      
      const selected = prompt(`ä» TAPD é€‰æ‹©éœ€æ±‚ï¼š\n\n${tapdList.join('\n')}\n\nè¾“å…¥éœ€æ±‚ç¼–å·ï¼ˆå¦‚ 12345ï¼‰ï¼š`);
      if (selected) {
        linkRequirement('#' + selected, 'é¢„çº¦å•æ”¯æŒé¢„ä»˜åŠŸèƒ½');
      }
    }
    
    // æ–°å»ºéœ€æ±‚
    function showNewRequirement() {
      const title = prompt('è¾“å…¥éœ€æ±‚æ ‡é¢˜ï¼š');
      if (title) {
        const newId = '#' + Math.floor(10000 + Math.random() * 90000);
        linkRequirement(newId, title);
        updateFlowHint(0, `å·²åˆ›å»ºæ–°éœ€æ±‚ ${newId}ï¼Œå¯ç»§ç»­å®Œå–„éœ€æ±‚è¯¦æƒ…`);
      }
    }
    
    // å…³è”éœ€æ±‚åˆ°å½“å‰åˆ†æ”¯
    function linkRequirement(id, title) {
      const branchName = document.getElementById('current-branch').textContent;
      branchRequirementMap[branchName] = { id, title, status: 'å¼€å‘ä¸­', priority: 'P1' };
      
      document.getElementById('requirement-linked').style.display = 'block';
      document.getElementById('requirement-unlinked').style.display = 'none';
      document.getElementById('requirement-linked').querySelector('.requirement-id').textContent = id;
      document.getElementById('requirement-linked').querySelector('.requirement-title').textContent = title;
      
      // æ˜¾ç¤ºä»»åŠ¡åˆ—è¡¨åŒºåŸŸ
      const taskSection = document.querySelector('.demo-sidebar .demo-section:nth-child(4)');
      if (taskSection) taskSection.style.display = 'block';
      
      updateFlowHint(0, `å·²å…³è”éœ€æ±‚ ${id} åˆ°åˆ†æ”¯ ${branchName}`);
    }
    
    // åˆ†ææŠ¥é”™
    function analyzeError() {
      const errorInput = document.getElementById('error-input').value.trim();
      if (!errorInput) {
        alert('è¯·å…ˆç²˜è´´æŠ¥é”™ä¿¡æ¯');
        return;
      }
      
      // æ¨¡æ‹Ÿ AI åˆ†æ
      const analysisResult = document.getElementById('error-result');
      const analysisContent = document.getElementById('error-analysis');
      
      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
      analysisContent.innerHTML = '<span style="color:var(--vscode-text-secondary);">ğŸ”„ æ­£åœ¨åˆ†æ...</span>';
      analysisResult.style.display = 'block';
      
      // æ¨¡æ‹Ÿå»¶è¿Ÿåæ˜¾ç¤ºç»“æœ
      setTimeout(() => {
        analysisContent.innerHTML = `
          <div style="margin-bottom:10px;"><strong>é—®é¢˜ç±»å‹ï¼š</strong>è¿è¡Œæ—¶ç±»å‹é”™è¯¯</div>
          <div style="margin-bottom:10px;"><strong>æ ¹å› åˆ†æï¼š</strong>å°è¯•è®¿é—® undefined æˆ– null å¯¹è±¡çš„å±æ€§ã€‚é€šå¸¸æ˜¯å› ä¸ºå¼‚æ­¥æ•°æ®æœªè¿”å›æ—¶å°±è®¿é—®äº†å…¶å±æ€§ï¼Œæˆ–è€…å‡½æ•°å‚æ•°æœªæ­£ç¡®ä¼ é€’ã€‚</div>
          <div style="margin-bottom:10px;"><strong>å»ºè®®ä¿®å¤ï¼š</strong></div>
          <ol style="margin:0;padding-left:20px;line-height:1.8;">
            <li>åœ¨è®¿é—®å±æ€§å‰æ·»åŠ ç©ºå€¼æ£€æŸ¥ï¼š<code style="background:rgba(255,255,255,0.1);padding:2px 6px;border-radius:3px;">params?.amount</code></li>
            <li>å‡½æ•°å…¥å£æ·»åŠ å‚æ•°æ ¡éªŒ</li>
            <li>æ£€æŸ¥è°ƒç”¨æ–¹æ˜¯å¦æ­£ç¡®ä¼ å‚</li>
          </ol>
        `;
      }, 1000);
    }
    
    // å¤åˆ¶åˆ†æç»“æœ
    function copyAnalysis() {
      const analysisContent = document.getElementById('error-analysis').innerText;
      navigator.clipboard.writeText(analysisContent).then(() => {
        alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
      });
    }
    
    // ç”Ÿæˆä»£ç  - è°ƒç”¨å¤–éƒ¨ AI æ’ä»¶
    function generateCode() {
      if (!selectedTaskId) {
        alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªä»»åŠ¡');
        return;
      }
      
      const task = tasks[selectedTaskId];
      const aiPlugin = document.getElementById('ai-plugin-selector').value;
      const pluginNames = { codebuddy: 'CodeBuddy', copilot: 'GitHub Copilot', codeium: 'Codeium' };
      
      // æ˜¾ç¤ºä¸Šä¸‹æ–‡å‡†å¤‡è¿‡ç¨‹
      updateFlowHint(2, 'æ­£åœ¨å‡†å¤‡ä¸Šä¸‹æ–‡...');
      showPanel('code-loading');
      document.getElementById('panel-code-loading').querySelector('.loading-text').textContent = 'æ­£åœ¨æ”¶é›†ä¸Šä¸‹æ–‡...';
      
      setTimeout(() => {
        // ç”Ÿæˆä¸Šä¸‹æ–‡ prompt
        const contextPrompt = generateContextPrompt(task);
        
        // æ˜¾ç¤ºç»“æœé¢æ¿ï¼ˆæ”¹ä¸ºå±•ç¤º prompt é¢„è§ˆï¼‰
        updateFlowHint(3, `ä¸Šä¸‹æ–‡å·²å‡†å¤‡å®Œæˆï¼Œå³å°†è°ƒç”¨ ${pluginNames[aiPlugin]} ç”Ÿæˆä»£ç `);
        showContextPreview(contextPrompt, aiPlugin);
      }, 1200);
    }
    
    // ç”Ÿæˆä¸Šä¸‹æ–‡ Prompt
    function generateContextPrompt(task) {
      return '## ä»»åŠ¡\n' + task.title + '\n\n## éœ€æ±‚èƒŒæ™¯\néœ€æ±‚ #12345ï¼šé¢„çº¦å•æ”¯æŒé¢„ä»˜åŠŸèƒ½\n- ç”¨æˆ·å¯åœ¨é¢„çº¦å•è¯¦æƒ…é¡µé€‰æ‹©é¢„ä»˜\n- è°ƒç”¨å¾®ä¿¡æ”¯ä»˜æ¥å£å®Œæˆæ”¯ä»˜\n- æ”¯ä»˜æˆåŠŸåæ›´æ–°è®¢å•çŠ¶æ€\n\n## éªŒæ”¶æ ‡å‡†\n' + task.checks.map(c => '- ' + c).join('\n') + '\n\n## è¯·å¸®æˆ‘ï¼š\n1. åˆ†æéœ€è¦ä¿®æ”¹å“ªäº›æ–‡ä»¶\n2. ç”Ÿæˆå®ç°ä»£ç \n3. ç¡®ä¿ç¬¦åˆå›¢é˜Ÿè§„èŒƒ';
    }
    
    // æ˜¾ç¤ºä¸Šä¸‹æ–‡é¢„è§ˆ
    function showContextPreview(prompt, aiPlugin) {
      const pluginNames = { codebuddy: 'CodeBuddy', copilot: 'GitHub Copilot', codeium: 'Codeium' };
      const resultPanel = document.getElementById('panel-code-result');
      const loadingPanel = document.getElementById('panel-code-loading');
      
      // æ›´æ–°ç»“æœé¢æ¿å†…å®¹
      resultPanel.innerHTML = '<div class="panel-card">' +
        '<div class="panel-card-header"><h3>ğŸ“‹ ä¸Šä¸‹æ–‡å·²å‡†å¤‡</h3></div>' +
        '<div class="panel-card-body">' +
          '<div style="margin-bottom:16px;">' +
            '<div style="font-size:13px;margin-bottom:8px;color:var(--vscode-text-secondary);">ä»¥ä¸‹ä¸Šä¸‹æ–‡å°†ä¼ é€’ç»™ ' + pluginNames[aiPlugin] + 'ï¼š</div>' +
            '<div class="code-block" style="max-height:280px;overflow-y:auto;font-size:12px;white-space:pre-wrap;">' + prompt + '</div>' +
          '</div>' +
          '<div class="btn-group">' +
            '<button class="btn btn-primary" onclick="invokeAIPlugin(\'' + aiPlugin + '\')">ğŸš€ è°ƒç”¨ ' + pluginNames[aiPlugin] + '</button>' +
            '<button class="btn btn-secondary" onclick="copyPrompt()">ğŸ“‹ å¤åˆ¶ Prompt</button>' +
            '<button class="btn btn-secondary" onclick="showPanel(\'task-detail\')">è¿”å›</button>' +
          '</div>' +
          '<div style="margin-top:12px;padding:12px;background:var(--vscode-panel-bg);border-radius:6px;font-size:12px;color:var(--vscode-text-secondary);">' +
            'ğŸ’¡ ç‚¹å‡»ã€Œè°ƒç”¨ã€åï¼Œå°†æ‰“å¼€ç›®æ ‡æ–‡ä»¶å¹¶è‡ªåŠ¨å¡«å……æ³¨é‡Šä¸Šä¸‹æ–‡ï¼Œç„¶åå”¤èµ· ' + pluginNames[aiPlugin] + ' è¿›è¡Œä»£ç ç”Ÿæˆ' +
          '</div>' +
        '</div>' +
      '</div>';
      
      loadingPanel.style.display = 'none';
      resultPanel.style.display = 'block';
    }
    
    // è°ƒç”¨ AI æ’ä»¶
    function invokeAIPlugin(plugin) {
      const pluginNames = { codebuddy: 'CodeBuddy', copilot: 'GitHub Copilot', codeium: 'Codeium' };
      
      // æ¨¡æ‹Ÿè°ƒç”¨è¿‡ç¨‹
      updateFlowHint(0, 'æ­£åœ¨æ‰“å¼€æ–‡ä»¶å¹¶è°ƒç”¨ ' + pluginNames[plugin] + '...');
      
      setTimeout(() => {
        alert('[æ¼”ç¤º] å°†æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š\n\n1. æ‰“å¼€æ–‡ä»¶ï¼špages/order-detail/prepay-modal/index.ts\n2. åœ¨æ–‡ä»¶é¡¶éƒ¨æ’å…¥ä¸Šä¸‹æ–‡æ³¨é‡Š\n3. æ‰§è¡Œå‘½ä»¤ï¼š' + plugin + '.generateCode\n4. ' + pluginNames[plugin] + ' å¼€å§‹ç”Ÿæˆä»£ç \n\nå®é™…ä½¿ç”¨æ—¶ä¼šç›´æ¥åœ¨ IDE ä¸­å®Œæˆè¿™äº›æ“ä½œã€‚');
        
        updateFlowHint(0, 'å·²è°ƒç”¨ ' + pluginNames[plugin] + 'ï¼Œè¯·åœ¨ç¼–è¾‘å™¨ä¸­ç»§ç»­äº¤äº’');
      }, 500);
    }
    
    // å¤åˆ¶ Prompt
    function copyPrompt() {
      const codeBlock = document.querySelector('#panel-code-result .code-block');
      if (codeBlock) {
        navigator.clipboard.writeText(codeBlock.textContent).then(() => {
          alert('Prompt å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
        });
      }
    }
    
    // ä»£ç æ£€æŸ¥ - è°ƒç”¨å¤–éƒ¨å·¥å…·
    function codeCheck() {
      if (!selectedTaskId) {
        alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªä»»åŠ¡');
        return;
      }
      
      const task = tasks[selectedTaskId];
      const aiPlugin = document.getElementById('ai-plugin-selector').value;
      const pluginNames = { codebuddy: 'CodeBuddy', copilot: 'GitHub Copilot', codeium: 'Codeium' };
      
      // æ£€æŸ¥å·¥å…·é€‰é¡¹
      const checkTools = [
        { id: 'eslint', name: 'ESLint', desc: 'ä»£ç è§„èŒƒæ£€æŸ¥' },
        { id: 'ai-review', name: pluginNames[aiPlugin] + ' Review', desc: 'AI ä»£ç å®¡æŸ¥' },
        { id: 'sonar', name: 'SonarQube', desc: 'ä»£ç è´¨é‡æ‰«æ' }
      ];
      
      // æ˜¾ç¤ºæ£€æŸ¥é€‰é¡¹
      const resultPanel = document.getElementById('panel-code-result');
      const loadingPanel = document.getElementById('panel-code-loading');
      
      resultPanel.innerHTML = '<div class="panel-card">' +
        '<div class="panel-card-header"><h3>ğŸ” é€‰æ‹©æ£€æŸ¥å·¥å…·</h3></div>' +
        '<div class="panel-card-body">' +
          '<div style="margin-bottom:16px;font-size:13px;color:var(--vscode-text-secondary);">é€‰æ‹©è¦è°ƒç”¨çš„ä»£ç æ£€æŸ¥å·¥å…·ï¼š</div>' +
          '<div style="display:flex;flex-direction:column;gap:8px;">' +
            checkTools.map(function(tool) {
              return '<div style="padding:12px;background:var(--vscode-panel-bg);border-radius:6px;cursor:pointer;border:1px solid var(--vscode-border);" onclick="runCodeCheck(\'' + tool.id + '\')" onmouseover="this.style.borderColor=\'var(--vscode-focus)\';" onmouseout="this.style.borderColor=\'var(--vscode-border)\';">' +
                '<div style="font-weight:500;margin-bottom:4px;">' + tool.name + '</div>' +
                '<div style="font-size:12px;color:var(--vscode-text-secondary);">' + tool.desc + '</div>' +
              '</div>';
            }).join('') +
          '</div>' +
          '<div style="margin-top:16px;">' +
            '<button class="btn btn-secondary" onclick="showPanel(\'task-detail\')">è¿”å›</button>' +
          '</div>' +
        '</div>' +
      '</div>';
      
      loadingPanel.style.display = 'none';
      resultPanel.style.display = 'block';
    }
    
    // æ‰§è¡Œä»£ç æ£€æŸ¥
    function runCodeCheck(toolId) {
      const task = tasks[selectedTaskId];
      const aiPlugin = document.getElementById('ai-plugin-selector').value;
      const pluginNames = { codebuddy: 'CodeBuddy', copilot: 'GitHub Copilot', codeium: 'Codeium' };
      
      const toolInfo = {
        'eslint': { name: 'ESLint', command: 'eslint.executeAutofix' },
        'ai-review': { name: pluginNames[aiPlugin] + ' Review', command: aiPlugin + '.review' },
        'sonar': { name: 'SonarQube', command: 'sonarlint.analyzeCurrentFile' }
      };
      
      const tool = toolInfo[toolId];
      
      alert('[æ¼”ç¤º] å°†æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š\n\n1. æ‰§è¡Œå‘½ä»¤ï¼š' + tool.command + '\n\n2. ' + tool.name + ' å°†åˆ†æå½“å‰æ‰“å¼€çš„æ–‡ä»¶\n\nå®é™…ä½¿ç”¨æ—¶ä¼šç›´æ¥åœ¨ IDE ä¸­å®Œæˆè¿™äº›æ“ä½œã€‚');
      
      showPanel('task-detail');
    }
    
    // ç¡®è®¤ä»»åŠ¡æ‹†åˆ†
    function confirmTaskSplit() {
      alert('ä»»åŠ¡å·²æ·»åŠ åˆ°ä»»åŠ¡åˆ—è¡¨ï¼');
      updateFlowHint(1, 'ä»»åŠ¡æ‹†åˆ†å®Œæˆï¼Œç‚¹å‡»ä»»åŠ¡åˆ—è¡¨ä¸­çš„ä»»åŠ¡å¼€å§‹å¼€å‘');
      showPanel('task-detail');
      selectTask(2);
    }
    
    // æ ‡è®°å®Œæˆ
    function completeTask() {
      if (!selectedTaskId) return;
      
      const taskItem = document.querySelectorAll('#task-list .task-item')[selectedTaskId - 1];
      if (taskItem) {
        taskItem.querySelector('.task-icon').className = 'task-icon completed';
        taskItem.querySelector('.task-icon').textContent = 'âœ“';
        taskItem.querySelector('.task-status').className = 'task-status completed';
        taskItem.querySelector('.task-status').textContent = 'å·²å®Œæˆ';
      }
      
      tasks[selectedTaskId].status = 'completed';
      tasks[selectedTaskId].statusText = 'å·²å®Œæˆ';
      
      document.getElementById('task-detail-status').textContent = 'å·²å®Œæˆ';
      document.getElementById('task-detail-status').className = 'task-status completed';
      
    }
    
    // æ›´æ–°æµç¨‹æç¤º
    function updateFlowHint(step, text) {
      const stepText = step > 0 ? 'æ­¥éª¤ ' + step + '/3' : 'æç¤º';
    }
  </script>
  
</body>
</html>
